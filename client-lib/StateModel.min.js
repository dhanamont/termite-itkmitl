var StateModel=Backbone.Model.extend({defaults:{numAffinityTerms:25,numSalientTerms:0,visibleTerms:[],totalTerms:25,foundTerms:"",unfoundTerms:"",sortType:"",addTopTwenty:!1,highlightedTerm:"",highlightedTopic:null,selectedTopics:{},doubleClickTopic:null,selectedTopicsStr:""},initialize:function(){this.termFreqView=this.matrixView=null}});StateModel.prototype.initModel=function(b,a){this.matrixView=b;this.termFreqView=a};
StateModel.prototype.setFoundTerms=function(b,a){this.set("foundTerms",b.join(", "),{silent:a})};StateModel.prototype.setUnfoundTerms=function(b,a){0<b.length&&""!=b[0]?this.set("unfoundTerms",b.join(", "),{silent:a}):this.set("unfoundTerms","",{silent:a})};StateModel.prototype.setVisibleTerms=function(b){this.set("visibleTerms",b.split(/[ ,;]+/g))};
StateModel.prototype.selectTopic=function(b){var a=DEFAULT;b in this.get("selectedTopics")?(freeColor(this.get("selectedTopics")[b]),delete this.get("selectedTopics")[b]):(a=getColor(),this.get("selectedTopics")[b]=a);this.trigger("color:topic",{topic:b,color:a})};StateModel.prototype.clearAllSelectedTopics=function(){console.log("clear all topics");var b=this.get("selectedTopics"),a;for(a in b)freeColor(b[a]),delete this.get("selectedTopics")[a],this.trigger("color:topic",{topic:a,color:DEFAULT})};
StateModel.prototype.getSortType=function(b){var a=["desc","asc",""];if(this.get("doubleClickTopic")!==b)return a[0];b=this.get("sortType");b=(a.indexOf(b)+1)%a.length;return a[b]};StateModel.prototype.setDoubleClickTopic=function(b){var a=this.getSortType(b);""===a?this.set("doubleClickTopic",null):this.set("doubleClickTopic",b);this.set("sortType",a)};StateModel.prototype.clearSorting=function(){this.set("doubleClickTopic",null);this.set("sortType","")};
StateModel.prototype.setHighlightedTerm=function(b){this.set("highlightedTerm",b)};StateModel.prototype.setHighlightedTopic=function(b){this.set("highlightedTopic",b)};
StateModel.prototype.loadStatesFromQueryString=function(){var b=function(a){for(;0<a.length;){var b=a.indexOf("#topic:"),c=a.indexOf("#color:");if(0<=b&&0<=c){b=parseInt(a.substring(b+7,c));var d=a.indexOf("#topic:",c+7);0<=d?(c=a.substring(c+7,d),a=a.substring(d)):(c=a.substring(c+7),c=c.replace(/[^A-Za-z0-9]/g,""),a="");this.get("selectedTopics")[b]=c}}}.bind(this),a=new QueryString;a.addValueParameter("numAffinityTerms","na","int");a.addValueParameter("numSalientTerms","ns","int");a.addArrayParameter("visibleTerms",
"t");a.addValueParameter("sortType","st","str");a.addValueParameter("doubleClickTopic","dct","int");a.addValueParameter("addTopTwenty","att","str");a.addValueParameter("selectedTopicsStr","tc","str");a=a.read();for(var c in a)"doubleClickTopic"===c&&-1===a[c]?this.set(c,null):"selectedTopicsStr"===c&&""!==a[c]?(b(a[c]),this.set(c,a[c])):"addTopTwenty"===c?"false"===a[c].replace(/[^A-Za-z0-9]/g,"")?this.set(c,!1):this.set(c,!0):this.set(c,a[c]);this.trigger("loaded:states");this.trigger("sending:colors",
this.get("selectedTopics"))};
StateModel.prototype.saveStatesToQueryString=function(){var b=new QueryString;b.addValueParameter("numAffinityTerms","na","int");b.addValueParameter("numSalientTerms","ns","int");b.addArrayParameter("visibleTerms","t");b.addValueParameter("sortType","st","str");b.addValueParameter("doubleClickTopic","dct","int");b.addValueParameter("addTopTwenty","att","str");var a=this.get("selectedTopics"),c="",d;for(d in a)a[d]!==DEFAULT&&(c+="#topic:"+d+"#color:"+a[d]);this.set("selectedTopicsStr",c);b.addValueParameter("selectedTopicsStr",
"tc","str");a="numAffinityTerms numSalientTerms visibleTerms sortType doubleClickTopic addTopTwenty selectedTopicsStr".split(" ");c={};for(d in a){var e=a[d];"doubleClickTopic"===e&&null===this.get(e)?c[e]=-1:c[e]=this.get(e)}b.write(c)};
