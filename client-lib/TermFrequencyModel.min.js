var TermFrequencyModel=Backbone.Model.extend({defaults:{termIndex:null,totalTermFreqs:{},topicalFreqMatrix:[],colorList:[],selectedTopics:{}},url:"data/global-term-freqs.json",initialize:function(){this.termFreqMap=this.originalTermIndex=this.originalTopicIndex=this.originalMatrix=this.stateModel=this.parentModel=null;this.selectedTopics={};this.colorList=[];this.colorToTopic={};this.topicalFreqs=null}});TermFrequencyModel.prototype.initModels=function(b,a){this.parentModel=b;this.stateModel=a};
TermFrequencyModel.prototype.defaultSelection=function(){for(var b=this.parentModel.get("topicIndex"),a=0;a<b.length;a++)this.selectedTopics[a]=null;this.set("selectedTopics",this.selectedTopics)};
TermFrequencyModel.prototype.load=function(){var b=function(a,b,e){this.set("termIndex",this.parentModel.get("termIndex"));this.originalMatrix=b.matrix;this.originalTopicIndex=b.topicIndex;this.originalTermIndex=b.termIndex;this.termFreqMap=b.termFreqMap;this.defaultSelection();this.getTotalTermFreqs();b=this.stateModel.get("selectedTopics");a=[];for(var c in b)claimColor(b[c]),a.push({topic:c,color:b[c]});a.sort(function(a,b){return colorNames.indexOf(a.color)-colorNames.indexOf(b.color)});for(c=
0;c<a.length;c++)this.selectTopic({topic:a[c].topic,color:a[c].color});this.trigger("loaded:freqModel")}.bind(this),a=function(a,b,e){}.bind(this);this.fetch({add:!1,success:b,error:a})};TermFrequencyModel.prototype.update=function(){this.generateTopicalMatrix(!0);this.getTotalTermFreqs();this.set("termIndex",this.parentModel.get("termIndex"))};
TermFrequencyModel.prototype.getTotalTermFreqs=function(){for(var b={},a=this.parentModel.get("termIndex"),c=0;c<a.length;c++)b[a[c]]=this.termFreqMap[a[c]];this.set("totalTermFreqs",b)};
TermFrequencyModel.prototype.generateTopicalMatrix=function(b){for(var a=[],c=this.parentModel.get("termIndex"),d=0;d<this.colorList.length;d++){for(var e=[],g=this.colorToTopic[this.colorList[d]],f=0;f<c.length;f++){var h=this.originalTermIndex.indexOf(c[f]);e.push(this.originalMatrix[h][g])}a.push(e)}this.topicalFreqs=a;this.set("topicalFreqMatrix",a,{silent:b});this.set("colorList",this.colorList);this.set("selectedTopics",this.selectedTopics);return a};
TermFrequencyModel.prototype.getTopicalsForTopic=function(b){for(var a=[],c=this.get("termIndex"),d=0;d<c.length;d++){var e=this.originalTermIndex.indexOf(c[d]);a.push(this.originalMatrix[e][b])}return a};
TermFrequencyModel.prototype.selectTopic=function(b){var a=b.topic;b=b.color;this.parentModel.get("topicIndex");if(null!==a){if(b===DEFAULT)if(null!==this.selectedTopics[a]){var c=this.colorList.indexOf(this.selectedTopics[a]);this.colorList.splice(c,1);this.selectedTopics[a]=null;delete this.colorToTopic[b]}else return;else null===this.selectedTopics[a]&&(this.selectedTopics[a]=b,this.colorList.push(b),this.colorToTopic[b]=a);this.generateTopicalMatrix(!1)}};
